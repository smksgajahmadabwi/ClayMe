<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClayMe - AI Selfie Transformer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f8fafc;
        }

        .clay-card {
            border-radius: 2rem;
        }

        .loader {
            border-top-color: #f97316;
            animation: spinner 0.6s linear infinite;
        }

        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748b'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1.5em;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-10">
            <div class="flex items-center justify-center gap-3 mb-2">
                <div class="p-3 bg-orange-500 rounded-2xl shadow-lg transform rotate-3">
                    <i class="fa-solid fa-palette text-white text-2xl"></i>
                </div>
                <h1 class="text-4xl font-extrabold tracking-tight text-slate-800">Clay<span class="text-orange-500">Me</span></h1>
            </div>
            <p class="text-slate-500 font-medium text-sm md:text-base">Ubah Selfie Jadi Karakter Clay 3D dengan 50+ Pilihan Tema</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Sisi Kiri: Panel Kontrol -->
            <div class="lg:col-span-4 space-y-6">
                
                <!-- 0. API Key Config -->
                <div class="bg-slate-900 p-6 clay-card shadow-xl border border-slate-800 text-white">
                    <label class="text-[10px] font-black text-orange-400 mb-3 block tracking-widest uppercase">
                        <i class="fa-solid fa-key"></i> Pengaturan API Gemini
                    </label>
                    <div class="flex gap-2">
                        <input type="password" id="api-key-input" placeholder="Masukkan API Key Anda..." class="flex-grow bg-slate-800 border border-slate-700 rounded-xl px-4 py-2 text-xs focus:outline-none focus:ring-1 focus:ring-orange-500 transition-all" />
                        <button id="save-key-btn" class="bg-orange-500 hover:bg-orange-600 px-4 py-2 rounded-xl text-xs font-bold transition-all">
                            Simpan
                        </button>
                    </div>
                    <p class="text-[9px] text-slate-400 mt-2 italic">*Kunci disimpan di browser Anda (LocalStorage), aman untuk GitHub.</p>
                </div>
                
                <!-- 1. Upload -->
                <div class="bg-white p-6 clay-card shadow-sm border border-slate-200">
                    <label class="text-xs font-black text-slate-700 mb-4 block flex items-center gap-2 uppercase tracking-wider">
                        <i class="fa-solid fa-cloud-arrow-up text-orange-500"></i> 1. Unggah Foto
                    </label>
                    <div id="drop-zone" class="relative group aspect-video rounded-2xl border-2 border-dashed border-slate-200 hover:border-orange-400 bg-slate-50 overflow-hidden transition-all cursor-pointer flex flex-col items-center justify-center">
                        <input type="file" id="file-input" accept="image/*" class="absolute inset-0 opacity-0 z-10 cursor-pointer" />
                        <div id="preview-container" class="hidden w-full h-full">
                            <img id="upload-preview" src="" class="w-full h-full object-cover" />
                        </div>
                        <div id="upload-placeholder" class="flex flex-col items-center text-slate-400">
                            <i class="fa-solid fa-camera text-3xl mb-2"></i>
                            <span class="text-[10px] font-bold">KLIK ATAU DRAG FOTO</span>
                        </div>
                    </div>
                </div>

                <!-- 2. Tema (Combobox) -->
                <div class="bg-white p-6 clay-card shadow-sm border border-slate-200">
                    <label class="text-xs font-black text-slate-700 mb-4 block flex items-center gap-2 uppercase tracking-wider">
                        <i class="fa-solid fa-wand-magic-sparkles text-orange-500"></i> 2. Pilih Konsep Tema
                    </label>
                    <select id="theme-select" class="w-full p-4 bg-slate-50 border border-slate-100 rounded-2xl text-sm font-semibold focus:ring-2 focus:ring-orange-400 outline-none transition-all cursor-pointer">
                        <!-- Options filled by JS -->
                    </select>
                </div>

                <!-- 3. Revisi -->
                <div class="bg-white p-6 clay-card shadow-sm border border-slate-200">
                    <label class="text-xs font-black text-slate-700 mb-4 block flex items-center gap-2 uppercase tracking-wider">
                        <i class="fa-solid fa-comment-dots text-orange-500"></i> 3. Tambahan Detail
                    </label>
                    <textarea id="revision-input" placeholder="Contoh: Tambahkan kacamata, ekspresi tersenyum, atau baju warna biru..." class="w-full p-4 bg-slate-50 border border-slate-100 rounded-2xl text-sm focus:ring-2 focus:ring-orange-400 outline-none h-24 resize-none transition-all"></textarea>
                </div>

            </div>

            <!-- Sisi Kanan: Hasil -->
            <div class="lg:col-span-8 space-y-6">
                <div class="bg-white p-6 rounded-[2.5rem] shadow-xl shadow-slate-200/50 border border-slate-100 min-h-[550px] flex flex-col relative">
                    
                    <!-- Top Bar -->
                    <div class="flex items-center justify-between mb-6 px-2">
                        <div class="flex items-center gap-2">
                            <div id="status-dot" class="w-2 h-2 rounded-full bg-green-500"></div>
                            <span id="status-text" class="text-[10px] font-black uppercase tracking-widest text-slate-400">Ready to Sculpt</span>
                        </div>
                        <button id="download-btn" class="hidden items-center gap-2 px-6 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-full text-xs font-black shadow-lg shadow-orange-200 transition-all active:scale-95">
                            <i class="fa-solid fa-download"></i> DOWNLOAD
                        </button>
                    </div>

                    <!-- Main Canvas -->
                    <div id="canvas-area" class="flex-grow flex items-center justify-center bg-slate-50 rounded-[2rem] border border-slate-100 overflow-hidden relative shadow-inner">
                        <!-- Initial Content -->
                        <div id="empty-state" class="text-center max-w-sm px-6">
                            <div class="w-20 h-20 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-6 text-orange-500">
                                <i class="fa-solid fa-palette text-3xl"></i>
                            </div>
                            <h3 class="text-slate-800 font-black mb-2 uppercase tracking-tight">Karakter Clay Anda</h3>
                            <p class="text-slate-400 text-sm font-medium">Hasil transformasi AI akan muncul di sini setelah Anda menekan tombol di bawah.</p>
                        </div>

                        <!-- Loading State -->
                        <div id="loading-state" class="hidden flex flex-col items-center gap-4 text-center p-8">
                            <div class="w-16 h-16 border-4 border-orange-100 border-t-orange-500 rounded-full loader"></div>
                            <p class="text-orange-600 font-black animate-pulse text-sm">PROSES PEMAHATAN TANAH LIAT...<br><span class="text-[10px] text-slate-400 font-normal">Mungkin membutuhkan waktu 10-20 detik</span></p>
                        </div>

                        <!-- Result Image -->
                        <img id="result-img" class="hidden max-h-full w-auto object-contain p-4" src="" alt="Hasil AI" />
                    </div>

                    <!-- Action Button -->
                    <div class="mt-6 flex gap-4">
                        <button id="generate-btn" class="flex-grow py-5 bg-slate-900 hover:bg-slate-800 text-white rounded-2xl font-black text-sm uppercase tracking-widest flex items-center justify-center gap-3 transition-all shadow-xl shadow-slate-200 active:scale-95">
                            <i class="fa-solid fa-wand-magic-sparkles text-orange-400"></i>
                            Proses Karakter Saya
                        </button>
                    </div>

                    <!-- Error Msg -->
                    <div id="error-box" class="hidden absolute bottom-24 left-10 right-10 p-4 bg-red-600 text-white rounded-2xl text-xs font-bold shadow-xl items-center gap-3 z-20">
                        <i class="fa-solid fa-triangle-exclamation"></i>
                        <span id="error-message"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API KEY HANDLING
        let API_KEY = localStorage.getItem('CLAYME_API_KEY') || "";
        const apiKeyInput = document.getElementById('api-key-input');
        const saveKeyBtn = document.getElementById('save-key-btn');

        if(API_KEY) {
            apiKeyInput.value = API_KEY;
            apiKeyInput.classList.add('border-green-500');
        }

        saveKeyBtn.onclick = () => {
            const val = apiKeyInput.value.trim();
            if(val) {
                localStorage.setItem('CLAYME_API_KEY', val);
                API_KEY = val;
                alert("API Key berhasil disimpan di browser Anda!");
            }
        };

        // THEMES DATA (50 Themes)
        const THEMES = [
            // TEKNOLOGI & KOMPUTER
            { label: 'Cyberpunk City', prompt: 'futuristic cyberpunk city with neon lights and holographic advertisements' },
            { label: 'Data Center / Server Room', prompt: 'modern data center with glowing server racks and fiber cables' },
            { label: 'Retro 80s Computer Lab', prompt: '1980s computer room with vintage beige monitors and floppy disks' },
            { label: 'Inside the Matrix', prompt: 'digital world with falling green code characters' },
            { label: 'Artificial Intelligence Core', prompt: 'glowing abstract AI brain with neural network connections' },
            { label: 'Coding Workspace', prompt: 'software developer desk with multiple monitors showing code' },
            { label: 'Robotics Factory', prompt: 'industrial robotics assembly line with mechanical arms' },
            { label: 'Circuit Board World', prompt: 'macro view of a glowing golden circuit board' },
            { label: 'Virtual Reality Arena', prompt: 'futuristic VR gaming arena with digital grid floors' },
            { label: 'Supercomputer Interface', prompt: 'massive supercomputer dashboard with complex data visualizations' },
            
            // ANTARIKSA
            { label: 'Mars Colony', prompt: 'futuristic red planet base with oxygen domes' },
            { label: 'Deep Space Nebula', prompt: 'colorful vibrant nebula clouds with billions of stars' },
            { label: 'International Space Station', prompt: 'looking through a cupola window at Earth from orbit' },
            { label: 'Lunar Base', prompt: 'moon surface with a lunar base and Earth in the distance' },
            { label: 'Black Hole Horizon', prompt: 'near a massive black hole with a glowing accretion disk' },
            { label: 'Saturn Rings', prompt: 'floating near the icy rings of Saturn' },
            { label: 'Asteroid Belt', prompt: 'surrounded by giant space rocks and distant sun' },
            { label: 'Alien Planet (Purple)', prompt: 'landscape with purple plants and two large moons' },
            { label: 'Sun Surface (Safe)', prompt: 'intense golden plasma and solar flares' },
            { label: 'Astronaut Spacewalk', prompt: 'floating in zero gravity above a blue planet' },

            // ALAM & FANTASI
            { label: 'Magic Forest', prompt: 'enchanted woods with giant glowing mushrooms' },
            { label: 'Underwater Coral Reef', prompt: 'vibrant tropical coral reef with sunlight rays' },
            { label: 'Volcano Peak', prompt: 'dramatic volcanic landscape with flowing lava' },
            { label: 'Cloud Kingdom', prompt: 'palace built on top of fluffy white clouds' },
            { label: 'Zen Garden', prompt: 'peaceful japanese garden with cherry blossoms' },
            { label: 'Steampunk City', prompt: 'industrial victorian city with brass pipes and zeppelins' },
            { label: 'Atlantis Underwater', prompt: 'ancient sunken ruins with glowing crystals' },
            { label: 'Candy Land', prompt: 'hills made of chocolate and rivers of pink syrup' },
            { label: 'Ice Castle', prompt: 'majestic fortress carved from pure blue ice' },
            { label: 'Safari Savanna', prompt: 'african savanna with acacia trees at sunset' },
            { label: 'Emerald Jungle', prompt: 'thick tropical jungle with exotic flowers' },
            { label: 'Lost Aztec Temple', prompt: 'overgrown ancient ruins in a deep forest' },
            { label: 'Floating Islands', prompt: 'islands floating in the sky with waterfalls' },
            { label: 'Fire & Flame', prompt: 'dramatic background of swirling fire and embers' },
            { label: 'Crystal Cave', prompt: 'dark cave filled with giant glowing amethysts' },
            
            // ARTISTIK & LAINNYA
            { label: 'LEGO Brick World', prompt: 'world made entirely of plastic toy bricks' },
            { label: 'Origami Paper World', prompt: 'landscape made of folded colorful paper' },
            { label: 'Pixel Art (Minecraft Style)', prompt: 'blocky 8-bit video game environment' },
            { label: 'Vaporwave Sunset', prompt: '80s retro sunset with pink grid and palm trees' },
            { label: 'Golden Luxury', prompt: 'background of melted liquid gold and diamonds' },
            { label: 'Abstract Paint Splash', prompt: 'vibrant explosion of colorful liquid paint' },
            { label: 'Medieval Castle', prompt: 'stone fortress with flying dragons in the sky' },
            { label: 'Paris (Eiffel Tower)', prompt: 'romantic paris street with the eiffel tower' },
            { label: 'Tokyo Night', prompt: 'busy tokyo street with neon signs and rain' },
            { label: 'Cozy Library', prompt: 'warm library with floor-to-ceiling bookshelves' },
            { label: 'Honey Bee Hive', prompt: 'inside a giant golden honeycomb' },
            { label: 'Dinosaur Era', prompt: 'prehistoric jungle with dinosaurs in background' },
            { label: 'Outer Space Diner', prompt: 'retro diner floating in the middle of space' },
            { label: 'Sand Desert (Egypt)', prompt: 'golden dunes with great pyramids' },
            { label: 'Grand Canyon', prompt: 'majestic red rock formations and deep valley' }
        ];

        // Initialize Combobox
        const themeSelect = document.getElementById('theme-select');
        THEMES.forEach((theme, idx) => {
            const opt = document.createElement('option');
            opt.value = idx;
            opt.innerText = theme.label;
            themeSelect.appendChild(opt);
        });

        // Image Handling
        let base64Image = null;
        const fileInput = document.getElementById('file-input');
        
        fileInput.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = () => {
                    document.getElementById('upload-placeholder').classList.add('hidden');
                    document.getElementById('preview-container').classList.remove('hidden');
                    document.getElementById('upload-preview').src = reader.result;
                    base64Image = reader.result.split(',')[1];
                };
                reader.readAsDataURL(file);
            }
        };

        // Generation Logic
        async function generate() {
            if (!API_KEY) return showError("Masukkan API Key Anda terlebih dahulu!");
            if (!base64Image) return showError("Pilih foto selfie Anda!");
            
            toggleLoading(true);
            const selectedIdx = themeSelect.value;
            const theme = THEMES[selectedIdx];
            const revision = document.getElementById('revision-input').value.trim();

            const prompt = `Transform this person into a professional 3D claymation character. 
            Keep their distinct facial structure, hairstyle, and unique features. 
            The character should look like it is made from high-quality modeling clay (Plastisin) with soft details and studio lighting. 
            Background/Theme: ${theme.prompt}. 
            ${revision ? 'Additional instruction: ' + revision : ''}
            Cinematic rendering, vibrant colors, clay-style texture.`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                { text: prompt },
                                { inlineData: { mimeType: "image/png", data: base64Image } }
                            ]
                        }],
                        generationConfig: { responseModalities: ['TEXT', 'IMAGE'] }
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || "Kesalahan API");
                }

                const data = await response.json();
                const resultB64 = data.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                if (resultB64) {
                    const finalSrc = `data:image/png;base64,${resultB64}`;
                    const imgEl = document.getElementById('result-img');
                    imgEl.src = finalSrc;
                    imgEl.classList.remove('hidden');
                    document.getElementById('empty-state').classList.add('hidden');
                    document.getElementById('download-btn').classList.replace('hidden', 'flex');
                } else {
                    throw new Error("Gagal memproses gambar. Coba ganti foto atau tema.");
                }
            } catch (err) {
                showError("Error: " + err.message);
            } finally {
                toggleLoading(false);
            }
        }

        function toggleLoading(isLoading) {
            document.getElementById('loading-state').classList.toggle('hidden', !isLoading);
            document.getElementById('empty-state').classList.toggle('hidden', isLoading);
            if(isLoading) document.getElementById('result-img').classList.add('hidden');
            
            document.getElementById('generate-btn').disabled = isLoading;
            document.getElementById('status-dot').className = isLoading ? 'w-2 h-2 rounded-full bg-orange-500 animate-ping' : 'w-2 h-2 rounded-full bg-green-500';
            document.getElementById('status-text').innerText = isLoading ? 'Proses Memahat...' : 'Ready to Sculpt';
        }

        function showError(msg) {
            const box = document.getElementById('error-box');
            document.getElementById('error-message').innerText = msg;
            box.classList.replace('hidden', 'flex');
            setTimeout(() => box.classList.replace('flex', 'hidden'), 6000);
        }

        document.getElementById('generate-btn').onclick = generate;
        
        document.getElementById('download-btn').onclick = () => {
            const link = document.createElement('a');
            link.href = document.getElementById('result-img').src;
            link.download = `ClayMe-${Date.now()}.png`;
            link.click();
        };
    </script>
</body>
</html>
